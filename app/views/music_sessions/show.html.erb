<div class="container">
  <div class="row">
    <div class="col-12">
      <p class="titre-page">CREER UNE SESSION</p>
      <div class="card-description">
        <h1>Session <%= @music_session.name %></h1>
        <p class="session-description"><%= @music_session.description %></p>
        <p><span class="tag-category">#<%= @music_session.category %></span></p>
        <div class="duree-total-session">
        <!-- Deplacer cette méthode Total Time dans le model afin de pouvoir l'appeler partout -->
          <% @total_time = 0 %>
          <% @music_session.sequences.each do |sequence| %>
            <% @total_time += sequence.duration %>
          <% end %>
          <p><%= image_tag 'duree_session.png', class: :sequence_icons %><%= "#{@total_time} min" if @total_time > 0 %></p>
        </div>
      </div>
    </div>
  </div>
  <!-- DEBUT : Faire apparaitre si aucune sequence créée -->
  <div class="row">
    <div class="col-12">
      <div class="sequence-header">
        <iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/1PjVu192kGpeyUgnAkq1YC?utm_source=generator&theme=0" width="100%" height="380" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>      </div>
    </div>
  </div>
  <!-- FIN  -->
  <!-- DEBUT : Séquence -->
  <div class="row">
    <div class="col-12">
      <div class="sequence-content">
        <% @number_sequence = 0 %>
        <% @music_session.sequences.each do |sequence| %>
          <div class="sequence-description">
            <% @number_sequence += 1  %>
            <%= link_to '', shuffle_track_path(sequence), class: :btn_shuffle_song, style: "background:url(#{image_path 'cta_shuffle_song.svg'})" %>
            <h2>Séquence <%= @number_sequence %></h2>
            <p><%= image_tag 'titre_sequence.png', class: :sequence_icons %><%= sequence.name %></p>
            <p><%= image_tag 'duree_sequence.png', class: :sequence_icons %> <%= sequence.duration %> min</p>
            <p><%= image_tag 'playlist_sequence.png', class: :sequence_icons %> <%= sequence.playlist_source_name %></p>
              <div data-controller="sortable" data-sortable-token-value="<%=session[:_csrf_token]%>">
                  <% sequence.tracks.order(:position).each do |track| %>
                    <div data-track-id="<%= track.id%>" class="d-flex justify-content-between align-items-center">
                      <p><strong><%= track.title %></strong>: <%= track.artist %></p>
                      <%= image_tag 'drag.svg', class: :sequence_drag_song %>
                      <%= link_to '', sequence_shuffle_a_track_path(sequence, track), class: :btn_shuffle_song, style: "background:url(#{image_path 'cta_shuffle_song.svg'})", data: {turbo_method: :shuffle, turbo_confirm: "Etes vous sur de vouloir modifier cette chanson?"} %>
                    </div>
                  <% end %>
              </div>
            <p><%= image_tag 'transition_sequence.png', class: :sequence_icons %> <%= sequence.transition %></p>
            <div class="buttons-navigation">
            <%= link_to '', edit_music_session_sequence_path(@music_session, sequence), class: :btn_modifier_sequence, style: "background:url(#{image_path 'cta_modifier_sequence.svg'})" %>
            <%= link_to '', sequence_path(sequence), class: :btn_supprimer_sequence, style: "background:url(#{image_path 'cta_supprimer_sequence.svg'})", data: {turbo_method: :delete, turbo_confirm: "Etes vous sur de vouloir supprimer cette séquence?"} %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
  <!-- FIN : Séquence hey hey -->
  <div class="row">
    <div class="col-12">
      <div class="sequence-footer">
        <%= link_to '', new_music_session_sequence_path(@music_session), class: :btn_ajouter, style: "background:url(#{image_path 'cta_ajouter.svg'})" %>
      </div>
    </div>
  </div>
  <div class="row">
    <%= link_to 'Valider la session', music_session_path(@music_session), class: :btn_home_black, style: "text-decoration:none;" %>
    <div class="col-12">
      <% if @number_sequence > 0 %>
          <button type="button" class="btn btn-dark">Jouer ma session</button>
      <% else %>
          <button type="button" class="d-none btn btn-dark">Jouer ma session</button>
      <% end %>
      <%= link_to 'Mes sessions', music_sessions_path(@music_session), class: :btn_home_black, style: "text-decoration:none;" %>
    </div>
  </div>
</div>
